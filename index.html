<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Token Uploader</title>
  <style>
    * {
      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #10131f, #1b2233);
      color: #f0f0f0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px;
    }

    .card {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      padding: 40px;
      width: 100%;
      max-width: 500px;
      backdrop-filter: blur(16px);
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.4);
      animation: fadeIn 0.8s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 {
      font-size: 26px;
      margin-bottom: 25px;
      color: #7de2fc;
      background: -webkit-linear-gradient(45deg, #7de2fc, #b9b6e5);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    select, input[type="file"] {
      width: 100%;
      margin-bottom: 20px;
      padding: 12px;
      border-radius: 10px;
      background-color: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      color: #fff;
      font-size: 14px;
    }

    button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(90deg, #00ffcc, #0099ff);
      color: #000;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    button:hover {
      filter: brightness(1.1);
      transform: scale(1.01);
    }

    #status {
      margin-top: 20px;
      font-size: 14px;
      text-align: center;
      color: #88f;
    }

    .console {
      margin-top: 20px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 12px;
      font-family: monospace;
      font-size: 13px;
      max-height: 150px;
      overflow-y: auto;
      color: #ccc;
    }

    .log-error { color: #ff7b7b; }
    .log-success { color: #88ff88; }
    .log-info { color: #7bd7ff; }
  </style>
</head>
<body>

  <div class="card">
    <h2>Upload Accounts & Generate Tokens</h2>
    <select id="region">
      <option value="">üåé Select Region</option>
      <option value="IND">India</option>
      <option value="NA">North America</option>
      <option value="RU">Russia</option>
    </select>
    <input type="file" id="fileInput" accept=".json" />
    <button onclick="generateTokens()">üöÄ Generate Tokens</button>
    <div id="status">Status: Awaiting file input...</div>
    <div class="console" id="console"></div>
  </div>

  <script>
    const log = (msg, type = "info") => {
      const line = document.createElement("div");
      line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      line.classList.add(`log-${type}`);
      document.getElementById("console").appendChild(line);
    };

    async function generateTokens() {
      const region = document.getElementById("region").value;
      const file = document.getElementById("fileInput").files[0];
      const status = document.getElementById("status");
      const consoleBox = document.getElementById("console");
      consoleBox.innerHTML = "";

      if (!file) {
        status.textContent = "‚ùå Please select a file.";
        log("No file selected", "error");
        return;
      }

      if (!region) {
        status.textContent = "‚ùå Please select a region.";
        log("Region not selected", "error");
        return;
      }

      status.textContent = "üîÑ Reading file...";
      let accounts = [];
      try {
        const text = await file.text();
        accounts = JSON.parse(text);
        if (!Array.isArray(accounts)) throw new Error("Not an array");
        log(`Parsed ${accounts.length} accounts`, "success");
      } catch (e) {
        status.textContent = "‚ùå Invalid JSON.";
        log("Invalid JSON: " + e.message, "error");
        return;
      }

      const result = [];
      status.textContent = "‚öôÔ∏è Generating tokens...";
      for (const acc of accounts) {
        if (!acc.uid || !acc.password) {
          log(`Missing UID or password in: ${JSON.stringify(acc)}`, "error");
          continue;
        }

        try {
          const url = `https://nation-jwt-api.vercel.app/token?uid=${acc.uid}&password=${acc.password}&key=gamerzmgr`;
          const res = await fetch(url);
          const data = await res.json();
          if (data.token && data.region === region) {
            result.push({ token: data.token });
            log(`Token OK: UID ${acc.uid}`, "success");
          } else {
            log(`Fail for UID ${acc.uid}: Region mismatch or no token`, "error");
          }
        } catch (err) {
          log(`Error fetching for UID ${acc.uid}: ${err.message}`, "error");
        }

        await new Promise(r => setTimeout(r, 300));
      }

      if (result.length === 0) {
        status.textContent = "‚ùå No tokens generated.";
        log("No valid tokens", "error");
        return;
      }

      const blob = new Blob([JSON.stringify(result, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `tokens_${region}.json`;
      a.click();

      status.textContent = `‚úÖ Downloaded ${result.length} tokens.`;
      log("Download complete", "success");
    }
  </script>

</body>
</html>
